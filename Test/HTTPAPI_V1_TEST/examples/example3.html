<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Example 3: update Document</title>

    <style>
        .error {
            color: red;
        }
    </style>
    <script type="text/javascript" src="../../lib/jquery/jquery.js"></script>

    <script>if (!("console" in window)) {
        window.console = {'log': function (s) {
        }}
    }</script>

    <script>

        $(document).ready(function () {

                    var baseurl = '../../';
                    function getValues() {

                        var aIds = $('[data-attr-id="1"]');
                        var aValues = $('[data-attr-value="1"]');
                        var values = {};
                        for (var i = 0; i < aIds.length; i++) {
                            if ($(aIds[i]).val() != '') {
                                values[$(aIds[i]).val()] = $(aValues[i]).val();

                            }
                        }
                        return values;
                    }

                    function getJSONValues() {
                        var values = getValues();
                        var rawValues = {};
                        for (var aid in  values) {

                                rawValues[aid] = {"value":values[aid]};

                        }


                        return {document: {
                            attributes: rawValues
                        }};
                    }

                    $("#updateRest").on("click", function () {
                        $.ajax({
                            type: "PUT",
                            dataType: "json",
                            contentType: 'application/x-www-form-urlencoded',
                            url: baseurl + "api/v1/documents/" + $('#docid').val() +'.json?fields=document.property.title, document.property.id, document.attributes',
                            data: getValues()
                        }).done(function (data) {
                            $('#result').text(JSON.stringify(data, undefined, 4));
                            $('#error').text('');
                            $('#errorText').text('');
                        }).fail(function (data) {

                            data.responseJSON = JSON.parse(data.responseText);
                            $('#error').text(JSON.stringify(data, undefined, 4));
                            $('#errorText').text(data.responseJSON.messages[0].contentText);
                            $('#result').text('');
                        });
                    });

                    $("#updateJson").on("click", function () {
                        $.ajax({
                            type: "PUT",
                            dataType: "json",
                            contentType: 'application/json',
                            url: baseurl + "api/v1/documents/" + $('#docid').val() ,
                            data: JSON.stringify(getJSONValues())
                        }).done(function (data) {
                            $('#result').text(JSON.stringify(data, undefined, 4));
                            $('#error').text('');
                            $('#errorText').text('');
                        }).fail(function (data) {

                            data.responseJSON = JSON.parse(data.responseText);
                            $('#error').text(JSON.stringify(data, undefined, 4));
                            $('#errorText').text(data.responseJSON.messages[0].contentText);
                            $('#result').text('');
                        });
                    });


                }
        );


    </script>
</head>

<body>
<h1>Update Document</h1>


<label for="docid">Doc id : </label><input placeholder="document id" id="docid" value="9"/>

<br/>
<input placeholder="attribute id" data-attr-id="1" value="ba_desc"/> :
<input placeholder="attribute value" data-attr-value="1" value="Un test"/><br/>

<input placeholder="attribute id" data-attr-id="1" value=""/> :
<input placeholder="attribute value" data-attr-value="1" value=""/><br/>

<input placeholder="attribute id" data-attr-id="1" value=""/> :
<input placeholder="attribute value" data-attr-value="1" value=""/><br/>


<input id="updateRest" type="button" value="Update FORM"/>
<input id="updateJson" type="button" value="Update JSON"/>

<hr/>


<pre id="result">RESULT HERE</pre>
<div class="error">
    <p id="errorText"></p>
    <pre id="error">ERROR HERE</pre>
</div>
</body>
</html>
